# 功能实现需求文档

> 基于策划原始需求整理，旨在明确开发目标与接口定义。

## 1. 游戏概览 (Overview)
*   **游戏类型**: 类幸存者 (Survivors-like) / Roguelite
*   **核心循环**: 移动射击 -> 杀敌 -> 拾取经验 -> 升级强化 -> 应对更强敌潮 -> 存活至倒计时结束。

## 2. 操控与输入 (Controls)

| 上下文 | 动作 | 输入方式 | 备注 |
| :--- | :--- | :--- | :--- |
| **UI 界面** | 交互 | 鼠标左键 | 菜单选择、升级选项 |
| **战斗** | 移动 | WASD / 方向键 | 8方向移动 |
| **战斗** | 瞄准 | 鼠标位置 | 准星跟随鼠标 |
| **战斗** | 射击 | 鼠标左键 | 手动射击 (注: 许多此类游戏为自动射击，需确认是否强制手动) |
| **系统** | 暂停 | ESC | 呼出暂停菜单 |

## 3. 游戏对象与数值 (Game Objects)

### 3.1 玩家角色 (Player)
*   **外观**: `bubble` (气泡)
*   **核心数值**:
    *   `生命值 (HP)`: 视觉化表现为“层数”（受到伤害爆一层）。
    *   `移动速度 (MoveSpeed)`
    *   `拾取范围 (PickupRange)`
    *   `攻击速度 (AttackSpeed)`
    *   `当前经验/升级阈值`: 经验曲线需配置。
    *   `弹道数 (ProjectileCount)`: 单次发射数量。
    *   `散射角度 (Spread)`: 多发子弹时的角度间隔。
*   **状态机**: `Idle` (静止), `Run` (移动), `Shoot` (射击), `LevelUp` (升级中), `Hurt` (受击), `Die` (死亡)。
*   **特殊机制**: **无敌帧 (Invincibility Frames)** - 受伤后无敌 1 秒。

### 3.2 投射物 (Projectiles)

#### 玩家子弹
*   **触发**: 玩家按下左键时创建。
*   **数值**:
    *   `伤害 (Damage)`
    *   `射程/飞行时间 (Range/Lifetime)`: 超出后销毁。
    *   `飞行速度 (Speed)`
    *   `穿透数 (Pierce)`: 初始为 1 (击中 1 个敌人后销毁)。

#### 敌人子弹
*   **触发**: 远程敌人攻击时创建。
*   **数值**: 固定速度。
*   **碰撞逻辑**:
    *   命中玩家 -> 玩家扣血 (爆层) -> 子弹销毁。
    *   **子弹对撞** -> 若与玩家子弹碰撞 -> 双方销毁 (抵消机制)。

### 3.3 敌人 (Enemies)

| 类型 | 行为逻辑 | 关键数值 | 动画状态 |
| :--- | :--- | :--- | :--- |
| **近战敌人** (Melee) | 持续向玩家移动，碰撞造成伤害 | HP, 移速, 攻速, 掉落经验量 | Move, Hurt, Die |
| **远程敌人** (Ranged) | 靠近玩家至一定距离后停止，发射直线子弹 | HP, 移速, 攻速 | Move, Idle(Aim), Hurt, Die |
| **大型敌人** (Tank/Boss) | 仅提及碰撞伤害，通常数值较高 | HP(高), 移速(低), 攻速 | Move, Hurt, Die |

### 3.4 掉落物 (Drops)
*   **经验点 (EXP Orb)**:
    *   **来源**: 敌人死亡时在坐标处生成。
    *   **行为**: 初始静止；当玩家进入 `拾取范围` 后，插值飞向玩家；接触玩家后销毁并增加经验。

## 4. 游戏流程 (Game Flow)

### 4.1 初始阶段 (Start)
*   **场景**: `StartMenu`
*   **功能**:
    *   [开始游戏] -> 切换至战斗场景。
    *   [退出] -> 关闭程序。

### 4.2 战斗阶段 (Gameplay)
*   **HUD 显示**:
    *   **顶部**: 经验条 (当前/阈值)。
    *   **中部/偏下**: 倒计时 (总时长 5 分钟)。
*   **刷怪逻辑 (Spawner)**:
    *   在屏幕可视范围外 (Off-screen) 生成。
    *   特定时间点触发特定波次 (需配置时间表)。
*   **升级逻辑**:
    *   经验值满 -> 游戏暂停 -> 弹出升级面板 (2选1) -> 选择后恢复游戏 -> 经验条重置(溢出处理需确认)。
*   **胜负判定**:
    *   **胜利**: 存活至 5 分钟倒计时结束。
    *   **失败**: 生命值归零。

### 4.3 结算阶段 (GameOver)
*   **场景**: 胜利或失败共用或独立界面。
*   **功能**: 显示结果 -> [确定] 按钮 -> 返回初始界面。

---
**待确认细节 (TODO)**:
1. "鼠标左键射击"是自动连发还是点按单发？(通常此类游戏为按住连发或全自动)。
2. "大型敌人"除了数值大，是否有特殊抗性或技能？
3. "子弹对撞抵消"是否适用于所有玩家子弹？
